<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with MSstatsConvert • MSstatsConvert</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with MSstatsConvert">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MSstatsConvert</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/msstats_data_format.html">Working with MSstatsConvert</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with MSstatsConvert</h1>
            
      
      
      <div class="hidden name"><code>msstats_data_format.Rmd</code></div>

    </div>

    
    
<div id="purpose-of-msstatsconvert" class="section level1">
<h1 class="hasAnchor">
<a href="#purpose-of-msstatsconvert" class="anchor"></a>Purpose of MSstatsConvert</h1>
<p>The <code>MSstatsConvert</code> package is a member of the <code>MSstatst</code> family of packages, MSstats and MSstatsTMT. It creates an abstraction for the steps in mass spectrometry (MS) data analysis that are required before a dataset can be used for statistical modeling. In short, the package is responsible for converting output from signal processing tools such as <code>OpenMS</code> or <code>MaxQuant</code> into a format suitable for statistical analysis. This includes:</p>
<ul>
<li>PSM- and protein-level filtering,</li>
<li>managing shared peptides,</li>
<li>removing decoy, iRT, and other irrelavant sequences,</li>
<li>removing features or proteins with a low number of measurements,</li>
<li>aggregating duplicated measurements,</li>
<li>handling fractionation by removing overlapped features,</li>
<li>creating balanced statistical design in the presence of missing data.</li>
</ul>
<p><code>MSstatsConvert</code> allows for transforming any MS quantification result into a format required by <code>MSstats</code> and <code>MSstatsTMT</code> packages. Additionally, it provides built-in cleaning functions for outputs of <code>DIAUmpire</code>, <code>MaxQuant</code>, <code>OpenMS</code>, <code>OpenSWATH</code>, <code>Progenesis</code>, <code>ProteomeDiscoverer</code>, <code>Skyline</code>, <code>Spectromine</code>, and <code>Spectronaut</code>. These functions serve as a base for converter functions (called <code>*toMSstatsFormat</code> or <code>*toMSstatsTMTFormat</code>) provided by the <code>MSstats</code> and <code>MSstatsTMT</code> packages.</p>
</div>
<div id="msstats-data-format" class="section level1">
<h1 class="hasAnchor">
<a href="#msstats-data-format" class="anchor"></a>MSstats data format</h1>
<p>MSstats family packages works with label-free, SRM and TMT datasets. The following column are required.</p>
<ul>
<li>
<code>ProteinName</code>: column that indicates a protein ID. If the analysis is to be made at the peptide-level, the column should store peptide IDs. Summarization performed by <code>MSstats</code> and <code>MSstatsTMT</code> packages is done separately for each ID in this column,</li>
<li>
<code>PeptideSequence</code>, <code>PrecursorCharge</code>, <code>FragmentIon</code> and <code>ProductCharge</code>: these four columns define a spectral feature (transition in SRM case). If information for any of the columns is not available, it should be set to a constant value (for example <code>NA</code>),</li>
<li>
<code>IsotopeLabelType</code>: column that indicates whether the measurement is based on an endogenous peptide (indicated by value “L” or “light”) or reference peptide (indicated by value “H” or “heavy”),</li>
<li>
<code>Run</code>: column that stores IDs of mass spectrometry runs. If annotation describing biological conditions and replicates is provided via a separate table, the run IDs should match <code>Run</code> IDs in the annotation,</li>
<li>
<code>Condition</code>: column that stores labels for biological conditions (groups of interest). For time-course experiments, this column will represent time points. If the design experiment includes both time points and distinct biological subjects, these labels should be a combination of subject and time point,</li>
<li>
<code>BioReplicate</code>: this column should contain a unique identifier for each biological replicate in the experiment. For example, in a clinical proteomic investigation this should be a unique patient ID. Patients from distinct groups (indicated by the <code>Condition</code> column) should have distinct IDs,</li>
<li>
<code>Intensity</code>: column that stores untransformed (in particular, no log transformation) measurements of feature abundance in a given Run (and Channel in TMT case). They can be peak heights, peak areas under the curve, or other quantitative representations of feature abundance,</li>
<li>for TMT datasets, a <code>Channel</code> column is required. Similarly to the <code>Run</code> column, values in this column must correspond to values in the annotation file, if provided separately.</li>
</ul>
<p>Additionally, if the experiment involves fractionation, <code>Fraction</code> column can be added to store fraction labels.</p>
</div>
<div id="logging" class="section level1">
<h1 class="hasAnchor">
<a href="#logging" class="anchor"></a>Logging</h1>
<p><code>MSstatsConvert</code> allows for flexible logging based on the <code>log4r</code> package. Information about preprocessing steps can be written to a file, to a console, to both or to neither. The <code>MSstatsLogsSettings</code> function helps manage log settings. The user can pass a path to an existing file to the <code>log_file_path</code> parameter. Combined with setting <code>append = TRUE</code>, this allows writing all information related to a specific data analysis to a single file. If a user does not specify a file, a new file will be created automatically with a name starting with “MSstats_log”, followed by a timestamp.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(MSstatsConvert)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># default - creates a new file</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="../reference/MSstatsLogsSettings.html">MSstatsLogsSettings</a></span>(<span class="dt">use_log_file =</span> <span class="ot">TRUE</span>, <span class="dt">append =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># default - creates a new file</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="../reference/MSstatsLogsSettings.html">MSstatsLogsSettings</a></span>(<span class="dt">use_log_file =</span> <span class="ot">TRUE</span>, <span class="dt">append =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb1-7" data-line-number="7">                    <span class="dt">log_file_path =</span> <span class="st">"log_file.log"</span>) </a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># switches logging off</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="../reference/MSstatsLogsSettings.html">MSstatsLogsSettings</a></span>(<span class="dt">use_log_file =</span> <span class="ot">FALSE</span>, <span class="dt">append =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># switches off logs and messages</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw"><a href="../reference/MSstatsLogsSettings.html">MSstatsLogsSettings</a></span>(<span class="dt">use_log_file =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) </a></code></pre></div>
<p>Additionally, session info generated by the <code><a href="https://rdrr.io/r/utils/sessionInfo.html">utils::sessionInfo()</a></code> function can be saved to file with the <code>MSstatsSaveSessionInfo</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/MSstatsSaveSessionInfo.html">MSstatsSaveSessionInfo</a></span>()</a></code></pre></div>
<p>By default, the output file name will start with “MSstats_session_info” and end with a current timestamp.</p>
</div>
<div id="importing-and-cleaning-data" class="section level1">
<h1 class="hasAnchor">
<a href="#importing-and-cleaning-data" class="anchor"></a>Importing and cleaning data</h1>
<p>MS data processing by <code>MSstatsConvert</code> starts with importing and cleaning data. The <code>MSstatsImport</code> function produces a wrapper for possibly multiple files that may describe a single dataset. For example, <code>MaxQuant</code> output consists of two files, while <code>OpenMS</code> outputs just a single file.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">maxquant_evidence =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"tinytest/raw_data/MaxQuant/mq_ev.csv"</span>,</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">                                         <span class="dt">package =</span> <span class="st">"MSstatsConvert"</span>))</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">maxquant_proteins =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"tinytest/raw_data/MaxQuant/mq_pg.csv"</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                                         <span class="dt">package =</span> <span class="st">"MSstatsConvert"</span>))</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">maxquant_imported =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsImport.html">MSstatsImport</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">evidence =</span> maxquant_evidence,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">                                       <span class="dt">protein_groups =</span> maxquant_proteins),</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">                                  <span class="dt">type =</span> <span class="st">"MSstats"</span>, <span class="dt">tool =</span> <span class="st">"MaxQuant"</span>)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">is</span>(maxquant_imported)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; [1] "MSstatsMaxQuantFiles" "MSstatsInputFiles"</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">openms_input =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">  <span class="st">"tinytest/raw_data/OpenMSTMT/openmstmt_input.csv"</span>,</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">  <span class="dt">package =</span> <span class="st">"MSstatsConvert"</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">))</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">openms_imported =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsImport.html">MSstatsImport</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">input =</span> openms_input),</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">                                <span class="st">"MSstatsTMT"</span>, <span class="st">"OpenMS"</span>)</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="kw">is</span>(openms_imported)</a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; [1] "MSstatsOpenMSFiles" "MSstatsInputFiles"</span></a></code></pre></div>
<p>The <code>getInputFile</code> method allows user to retrieve the files:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/getInputFile.html">getInputFile</a></span>(maxquant_imported, <span class="st">"evidence"</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt;       Sequence Length Modifications Modifiedsequence OxidationMProbabilities</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; 1: AEAPAAAPAAK     11    Unmodified    _AEAPAAAPAAK_                        </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; 2: AEAPAAAPAAK     11    Unmodified    _AEAPAAAPAAK_                        </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; 3: AEAPAAAPAAK     11    Unmodified    _AEAPAAAPAAK_                        </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; 4: AEAPAAAPAAK     11    Unmodified    _AEAPAAAPAAK_                        </span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; 5: AEAPAAAPAAK     11    Unmodified    _AEAPAAAPAAK_</span></a></code></pre></div>
<p>As a next step of the analysis, input files are combined into a single <code>data.table</code> with standardized column names by the <code>MSstatsClean</code> function. It is a generic function with built-in support for outputs of tools listed in the “Purpose of the MSstatsConvert package” section. The <code>type</code> parameter is equal to either <code>MSstats</code> or <code>MSstatsTMT</code> and indicates if the data comes from a labelled TMT experiment.</p>
<p>For some datasets, <code>MSstatsClean</code> may require additional parameters described in the respective help files. For our example datasets, the following calls merge input files into a single table.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">maxquant_cleaned =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsClean.html">MSstatsClean</a></span>(maxquant_imported, <span class="dt">protein_id_col =</span> <span class="st">"Proteins"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(maxquant_cleaned)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;    ProteinName PeptideSequence Modifications PrecursorCharge</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; 1:      P06959     AEAPAAAPAAK    Unmodified               2</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 2:      P06959     AEAPAAAPAAK    Unmodified               2</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 3:      P06959     AEAPAAAPAAK    Unmodified               2</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; 4:      P06959     AEAPAAAPAAK    Unmodified               2</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; 5:      P06959     AEAPAAAPAAK    Unmodified               2</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; 6:      P06959     AEAPAAAPAAK    Unmodified               2</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;                                            Run Intensity   Score</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; 1: 121219_S_CCES_01_01_LysC_Try_1to10_Mixt_1_1   4023100  76.332</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; 2: 121219_S_CCES_01_02_LysC_Try_1to10_Mixt_1_2   5132500  83.081</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; 3: 121219_S_CCES_01_03_LysC_Try_1to10_Mixt_1_3   2761600 104.430</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; 4: 121219_S_CCES_01_05_LysC_Try_1to10_Mixt_2_2   4091800  94.465</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; 5: 121219_S_CCES_01_06_LysC_Try_1to10_Mixt_2_3   4727000  88.596</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; 6: 121219_S_CCES_01_08_LysC_Try_1to10_Mixt_3_2   2258400  90.050</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">openms_cleaned =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsClean.html">MSstatsClean</a></span>(openms_imported)</a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(openms_cleaned)</a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;             ProteinName                               PeptideSequence</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; 1: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; 2: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; 3: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt; 4: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt; 5: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt; 6: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt;    PrecursorCharge</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt; 1:               3</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="co">#&gt; 2:               3</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co">#&gt; 3:               3</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="co">#&gt; 4:               3</span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32"><span class="co">#&gt; 5:               3</span></a>
<a class="sourceLine" id="cb5-33" data-line-number="33"><span class="co">#&gt; 6:               3</span></a>
<a class="sourceLine" id="cb5-34" data-line-number="34"><span class="co">#&gt;                                                                 PSM Condition</span></a>
<a class="sourceLine" id="cb5-35" data-line-number="35"><span class="co">#&gt; 1: .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3_4359.56536443198   Long_HF</span></a>
<a class="sourceLine" id="cb5-36" data-line-number="36"><span class="co">#&gt; 2: .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3_6190.04195694402   Long_HF</span></a>
<a class="sourceLine" id="cb5-37" data-line-number="37"><span class="co">#&gt; 3: .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3_4359.56536443198   Long_HF</span></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"><span class="co">#&gt; 4: .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3_6190.04195694402   Long_HF</span></a>
<a class="sourceLine" id="cb5-39" data-line-number="39"><span class="co">#&gt; 5: .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3_6190.04195694402   Long_HF</span></a>
<a class="sourceLine" id="cb5-40" data-line-number="40"><span class="co">#&gt; 6: .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3_4359.56536443198   Long_HF</span></a>
<a class="sourceLine" id="cb5-41" data-line-number="41"><span class="co">#&gt;    BioReplicate   Run Channel Intensity Mixture TechRepMixture Fraction</span></a>
<a class="sourceLine" id="cb5-42" data-line-number="42"><span class="co">#&gt; 1:           21 3_3_3       1        NA       3            3_3        3</span></a>
<a class="sourceLine" id="cb5-43" data-line-number="43"><span class="co">#&gt; 2:           21 3_3_3       1        NA       3            3_3        3</span></a>
<a class="sourceLine" id="cb5-44" data-line-number="44"><span class="co">#&gt; 3:           24 3_3_3       4        NA       3            3_3        3</span></a>
<a class="sourceLine" id="cb5-45" data-line-number="45"><span class="co">#&gt; 4:           24 3_3_3       4        NA       3            3_3        3</span></a>
<a class="sourceLine" id="cb5-46" data-line-number="46"><span class="co">#&gt; 5:           26 3_3_3       6        NA       3            3_3        3</span></a>
<a class="sourceLine" id="cb5-47" data-line-number="47"><span class="co">#&gt; 6:           26 3_3_3       6  1820.072       3            3_3        3</span></a></code></pre></div>
<p>If a user wants to use <code>MSstatsConvert</code> package with data in a format that is not currently supported, it is enough to first re-format the data into a <code>data.table</code> with column ProteinName, PeptideSequence, PrecursorCharge, FragmentIon, ProductCharge (with the latter two possibly equal to NA), Run and IsotopeLabelType (in case of non-TMT data) or Channel (in case of TMT data). Moreover, the dataset may include any column that will be used for filtering the dataset (for example a column that stores q-values). In our example, such additional columns are “Modifications” and “Score” from MaxQuant files.</p>
<p>Annotation columns should be called Condition and BioReplicate. For TMT data, Mixture, TechRepMixture columns may be added. Fractionation should be indicated by a Fraction column.</p>
</div>
<div id="preprocessing" class="section level1">
<h1 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h1>
<p>The goal of <code>MSstatsPreprocess</code> function is to transform cleaned MS data into a format ready for statistical analysis with <code>MSstats</code> or <code>MSstatsTMT</code> packages. This function accepts several parameters, and each corresponds to a preprocessing step.</p>
<ul>
<li>
<code>input</code> parameter is the dataset for preprocessing,</li>
<li>
<code>annotation</code> is a description of biological conditions and replicates associated with MS runs (and channels in TMT case). If annotation is already included in the <code>input</code>, it should be equal to <code>NULL</code>. The annotation should be created by the <code>MSstatsMakeAnnotation</code> function,</li>
<li>
<code>feature_columns</code> is a vector of column names that will denote features,</li>
<li>
<code>remove_shared_peptides</code> is a logical parameter - if <code>TRUE</code>, shared peptides will be removed from the analysis. Currently, <code>MSstats</code> assumes that only unique peptides are used, and presence of shared peptides may cause issues,</li>
<li>
<code>remove_single_feature_proteins</code> is a logical parameter that indicates if proteins that only have a single feature should be removed from the analysis (<code>TRUE</code>),</li>
<li>
<code>feature_cleaning</code> is a list, that currently consists of two named elements: <code>remove_features_with_few_measurements</code> should be equal to TRUE or FALSE. In the first case, feature that have less than three measurements across runs (or channels in a run for TMT data) will be removed. FALSE means that only features with no non-missing measurements will be removed. The <code>summarize_multiple_psms</code> element should be a function that will be used to aggregate multiple feature measurements within a single MS run,</li>
<li>
<code>aggregate_isotopic</code> is a logical parameter - <code>TRUE</code> means that isotopic peaks will be aggregated (currently only used for Skyline input),</li>
<li>
<code>columns_to_fill</code> is an optional named list with names corresponding to columns and values correponding to values that will be used for these columns. For example, if the dataset is missing information about <code>ProductCharge</code>, such a column can be added by passing <code><a href="https://rdrr.io/r/base/list.html">list(ProductCharge = NA)</a></code> to this parameter,</li>
<li>
<code>score_filtering</code>, <code>exact_filtering</code> and <code>pattern_filtering</code> parameters are optional parameters that can be used to perform data filtering. An example is given below.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">maxquant_annotation =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="st">"tinytest/raw_data/MaxQuant/annotation.csv"</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">package =</span> <span class="st">"MSstatsConvert"</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">))</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">maxquant_annotation =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsMakeAnnotation.html">MSstatsMakeAnnotation</a></span>(maxquant_cleaned,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                                            maxquant_annotation,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                                            <span class="dt">Run =</span> <span class="st">"Rawfile"</span>)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">m_filter =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">col_name =</span> <span class="st">"PeptideSequence"</span>, </a>
<a class="sourceLine" id="cb6-9" data-line-number="9">                <span class="dt">pattern =</span> <span class="st">"M"</span>, </a>
<a class="sourceLine" id="cb6-10" data-line-number="10">                <span class="dt">filter =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb6-11" data-line-number="11">                <span class="dt">drop_column =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">oxidation_filter =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">col_name =</span> <span class="st">"Modifications"</span>, </a>
<a class="sourceLine" id="cb6-14" data-line-number="14">                        <span class="dt">pattern =</span> <span class="st">"Oxidation"</span>, </a>
<a class="sourceLine" id="cb6-15" data-line-number="15">                        <span class="dt">filter =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb6-16" data-line-number="16">                        <span class="dt">drop_column =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-17" data-line-number="17"></a>
<a class="sourceLine" id="cb6-18" data-line-number="18">feature_columns =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PeptideSequence"</span>, <span class="st">"PrecursorCharge"</span>)</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">maxquant_processed =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsPreprocess.html">MSstatsPreprocess</a></span>(</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">  maxquant_cleaned, </a>
<a class="sourceLine" id="cb6-21" data-line-number="21">  maxquant_annotation,</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">  feature_columns,</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">  <span class="dt">remove_shared_peptides =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb6-24" data-line-number="24">  <span class="dt">remove_single_feature_proteins =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb6-25" data-line-number="25">  <span class="dt">pattern_filtering =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">oxidation =</span> oxidation_filter,</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">                           <span class="dt">m =</span> m_filter),</a>
<a class="sourceLine" id="cb6-27" data-line-number="27">  <span class="dt">feature_cleaning =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">remove_features_with_few_measurements =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-28" data-line-number="28">                          <span class="dt">summarize_multiple_psms =</span> max),</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">  <span class="dt">columns_to_fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"FragmentIon"</span> =<span class="st"> </span><span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">                         <span class="st">"ProductCharge"</span> =<span class="st"> </span><span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb6-31" data-line-number="31">                         <span class="st">"IsotopeLabelType"</span> =<span class="st"> "L"</span>))</a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(maxquant_processed)</a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="co">#&gt;                                            Run PeptideSequence PrecursorCharge</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="co">#&gt; 1: 121219_S_CCES_01_01_LysC_Try_1to10_Mixt_1_1     AEAPAAAPAAK               2</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35"><span class="co">#&gt; 2: 121219_S_CCES_01_02_LysC_Try_1to10_Mixt_1_2     AEAPAAAPAAK               2</span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36"><span class="co">#&gt; 3: 121219_S_CCES_01_03_LysC_Try_1to10_Mixt_1_3     AEAPAAAPAAK               2</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37"><span class="co">#&gt; 4: 121219_S_CCES_01_05_LysC_Try_1to10_Mixt_2_2     AEAPAAAPAAK               2</span></a>
<a class="sourceLine" id="cb6-38" data-line-number="38"><span class="co">#&gt; 5: 121219_S_CCES_01_06_LysC_Try_1to10_Mixt_2_3     AEAPAAAPAAK               2</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39"><span class="co">#&gt; 6: 121219_S_CCES_01_08_LysC_Try_1to10_Mixt_3_2     AEAPAAAPAAK               2</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40"><span class="co">#&gt;    Intensity ProteinName Condition BioReplicate Experiment IsotopeLabelType</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41"><span class="co">#&gt; 1:   4023100      P06959         1            1        1_1                L</span></a>
<a class="sourceLine" id="cb6-42" data-line-number="42"><span class="co">#&gt; 2:   5132500      P06959         1            1        1_2                L</span></a>
<a class="sourceLine" id="cb6-43" data-line-number="43"><span class="co">#&gt; 3:   2761600      P06959         1            1        1_3                L</span></a>
<a class="sourceLine" id="cb6-44" data-line-number="44"><span class="co">#&gt; 4:   4091800      P06959         2            2        2_2                L</span></a>
<a class="sourceLine" id="cb6-45" data-line-number="45"><span class="co">#&gt; 5:   4727000      P06959         2            2        2_3                L</span></a>
<a class="sourceLine" id="cb6-46" data-line-number="46"><span class="co">#&gt; 6:   2258400      P06959         3            3        3_2                L</span></a>
<a class="sourceLine" id="cb6-47" data-line-number="47"><span class="co">#&gt;    FragmentIon ProductCharge</span></a>
<a class="sourceLine" id="cb6-48" data-line-number="48"><span class="co">#&gt; 1:          NA            NA</span></a>
<a class="sourceLine" id="cb6-49" data-line-number="49"><span class="co">#&gt; 2:          NA            NA</span></a>
<a class="sourceLine" id="cb6-50" data-line-number="50"><span class="co">#&gt; 3:          NA            NA</span></a>
<a class="sourceLine" id="cb6-51" data-line-number="51"><span class="co">#&gt; 4:          NA            NA</span></a>
<a class="sourceLine" id="cb6-52" data-line-number="52"><span class="co">#&gt; 5:          NA            NA</span></a>
<a class="sourceLine" id="cb6-53" data-line-number="53"><span class="co">#&gt; 6:          NA            NA</span></a>
<a class="sourceLine" id="cb6-54" data-line-number="54"></a>
<a class="sourceLine" id="cb6-55" data-line-number="55"><span class="co"># OpenMS - TMT data</span></a>
<a class="sourceLine" id="cb6-56" data-line-number="56">feature_columns_tmt =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PeptideSequence"</span>, <span class="st">"PrecursorCharge"</span>)</a>
<a class="sourceLine" id="cb6-57" data-line-number="57">openms_processed =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsPreprocess.html">MSstatsPreprocess</a></span>(</a>
<a class="sourceLine" id="cb6-58" data-line-number="58">  openms_cleaned, </a>
<a class="sourceLine" id="cb6-59" data-line-number="59">  <span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb6-60" data-line-number="60">  feature_columns_tmt,</a>
<a class="sourceLine" id="cb6-61" data-line-number="61">  <span class="dt">remove_shared_peptides =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-62" data-line-number="62">  <span class="dt">remove_single_feature_proteins =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-63" data-line-number="63">  <span class="dt">feature_cleaning =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">remove_features_with_few_measurements =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-64" data-line-number="64">                          <span class="dt">summarize_multiple_psms =</span> max)</a>
<a class="sourceLine" id="cb6-65" data-line-number="65">)</a>
<a class="sourceLine" id="cb6-66" data-line-number="66"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(openms_processed)</a>
<a class="sourceLine" id="cb6-67" data-line-number="67"><span class="co">#&gt;             ProteinName                               PeptideSequence</span></a>
<a class="sourceLine" id="cb6-68" data-line-number="68"><span class="co">#&gt; 1: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb6-69" data-line-number="69"><span class="co">#&gt; 2: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb6-70" data-line-number="70"><span class="co">#&gt; 3: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb6-71" data-line-number="71"><span class="co">#&gt; 4: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb6-72" data-line-number="72"><span class="co">#&gt; 5: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb6-73" data-line-number="73"><span class="co">#&gt; 6: sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb6-74" data-line-number="74"><span class="co">#&gt;    PrecursorCharge                                             PSM Condition</span></a>
<a class="sourceLine" id="cb6-75" data-line-number="75"><span class="co">#&gt; 1:               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3   Long_HF</span></a>
<a class="sourceLine" id="cb6-76" data-line-number="76"><span class="co">#&gt; 2:               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3   Long_HF</span></a>
<a class="sourceLine" id="cb6-77" data-line-number="77"><span class="co">#&gt; 3:               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3   Long_HF</span></a>
<a class="sourceLine" id="cb6-78" data-line-number="78"><span class="co">#&gt; 4:               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3   Long_HF</span></a>
<a class="sourceLine" id="cb6-79" data-line-number="79"><span class="co">#&gt; 5:               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3   Long_LF</span></a>
<a class="sourceLine" id="cb6-80" data-line-number="80"><span class="co">#&gt; 6:               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3    Long_M</span></a>
<a class="sourceLine" id="cb6-81" data-line-number="81"><span class="co">#&gt;    BioReplicate   Run Channel Intensity Mixture TechRepMixture Fraction</span></a>
<a class="sourceLine" id="cb6-82" data-line-number="82"><span class="co">#&gt; 1:           21 3_3_3       1        NA       3            3_3        3</span></a>
<a class="sourceLine" id="cb6-83" data-line-number="83"><span class="co">#&gt; 2:           24 3_3_3       4        NA       3            3_3        3</span></a>
<a class="sourceLine" id="cb6-84" data-line-number="84"><span class="co">#&gt; 3:           26 3_3_3       6 1820.0721       3            3_3        3</span></a>
<a class="sourceLine" id="cb6-85" data-line-number="85"><span class="co">#&gt; 4:           28 3_3_3       8  445.7412       3            3_3        3</span></a>
<a class="sourceLine" id="cb6-86" data-line-number="86"><span class="co">#&gt; 5:           25 3_3_3       5 1580.9510       3            3_3        3</span></a>
<a class="sourceLine" id="cb6-87" data-line-number="87"><span class="co">#&gt; 6:           23 3_3_3       3 1508.3302       3            3_3        3</span></a></code></pre></div>
<p>Annotation is created via the <code>MSstatsMakeAnnotation</code> function. It takes the cleaned dataset and annotation file as input. Additionally, key-value pairs can be passed to this function to change column names (not including dots and other symbols) in the annotation from names given by values to names given by keys.</p>
<p>For programmatic applications and consistency of the interface, filtering is done with the help of lists.</p>
<p>For filtering based on numerical scores (for example q-value filtering), the list should consist of elements named</p>
<ul>
<li>
<code>score_column</code>: name of a column that stores the score,</li>
<li>
<code>score_threshold</code>: value above or below which measurements should be kept,</li>
<li>
<code>direction</code>: if “greater”, values greater than <code>score_threshold</code> will be kept; if “smaller”, values smaller than <code>score_threshold</code> will be kept;</li>
<li>
<code>behavior</code>: if “remove”, rows not below/above the threshold will be removed; if “replace”, intensity in rows not below/above the threshold will be replaced by a given value,</li>
<li>
<code>handle_na</code>: if “keep”, <code>NA</code> in the score column will not be removed,</li>
<li>
<code>fill_value</code>: value that will be used if <code>behavior = "replace"</code>,</li>
<li>
<code>filter</code>: if <code>TRUE</code>, filtering will be performed (can be used for conditional filtering),</li>
<li>
<code>drop_column</code>: if <code>TRUE</code>, column that stored the score will be removed.</li>
</ul>
<p>For example, to remove intensities smaller than 1, we could pass the following list to the <code>score_filtering</code> parameters:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">score_column =</span> <span class="st">"Intensity"</span>, <span class="dt">score_threshold =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">       <span class="dt">direction =</span> <span class="st">"greater"</span>, <span class="dt">behavior =</span> <span class="st">"remove"</span>, </a>
<a class="sourceLine" id="cb7-4" data-line-number="4">       <span class="dt">handle_na =</span> <span class="st">"remove"</span>, <span class="dt">fill_value =</span> <span class="ot">NA</span>, <span class="dt">filter =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">       )</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">)</a></code></pre></div>
<p>For filtering based on patterns (for example, removing oxidation peptides), the list should consist of elements named</p>
<ul>
<li>
<code>col_name</code>: name of a column that values that may be removed,</li>
<li>
<code>filter_symbols</code>: vector of values - rows with these values in <code>col_name</code> will be removed or corresponding intensities will be replaced,</li>
<li>
<code>behavior</code>: if “remove”, rows that contain <code>filter_symbols</code> in <code>col_name</code> will be removed; if “replace”, intensity in rows that contain <code>filter_symbols</code> in <code>col_name</code> will be replaced by a given value,</li>
<li>
<code>fill_value</code>: value that will be used if <code>behavior = "replace"</code>,</li>
<li>
<code>filter</code>: if <code>TRUE</code>, filtering will be performed (can be used for conditional filtering),</li>
<li>
<code>drop_column</code>: if <code>TRUE</code>, column that stored the score will be removed.</li>
</ul>
<p>For filtering based on exact values (for example, removing iRT proteins), the list should consists of elements named</p>
<ul>
<li>
<code>col_name</code>: name of a column that stores strings that will be searched for given patterns,</li>
<li>
<code>pattern</code>: vector of regular expressions - rows with matching values in <code>col_name</code> will be removed,</li>
<li>
<code>filter</code>: if <code>TRUE</code>, filtering will be performed (can be used for conditional filtering),</li>
<li>
<code>drop_column</code>: if <code>TRUE</code>, column that stored the values for filtering will be removed.</li>
</ul>
</div>
<div id="fractions-and-balanced-design" class="section level1">
<h1 class="hasAnchor">
<a href="#fractions-and-balanced-design" class="anchor"></a>Fractions and balanced design</h1>
<p>Finally, after preprocessing, <code>MSstatsBalancedDesign</code> function can be applied to handle fractions and create balanced design. For label-free and SRM data, it means that fractionation or technical replicates will be detected if these information is not provided. Features measured in multiple fractions (overlapped) will be assigned to a unique fraction. Then, the data will be adjusted so that within each fraction, every feature has a row for certain run. If the intensity value is missing, it will be denoted by <code>NA</code>.</p>
<p>For TMT data, a unique fraction will be selected for each overlapped feature and the data will adjusted so that within each run, every feature has a row for each channel. If the intensity is missing for a channel, it will be denoted by <code>NA</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">maxquant_balanced =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsBalancedDesign.html">MSstatsBalancedDesign</a></span>(maxquant_processed, feature_columns)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(maxquant_balanced)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;   ProteinName PeptideSequence PrecursorCharge FragmentIon ProductCharge</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; 1      P06959     AEAPAAAPAAK               2          NA            NA</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; 2      P06959     AEAPAAAPAAK               2          NA            NA</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; 3      P06959     AEAPAAAPAAK               2          NA            NA</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; 4      P06959     AEAPAAAPAAK               2          NA            NA</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; 5      P06959     AEAPAAAPAAK               2          NA            NA</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; 6      P06959     AEAPAAAPAAK               2          NA            NA</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;   IsotopeLabelType Condition BioReplicate</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; 1                L         1            1</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; 2                L         1            1</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; 3                L         1            1</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; 4                L         2            2</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; 5                L         2            2</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; 6                L         2            2</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;                                           Run Fraction Intensity</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; 1 121219_S_CCES_01_01_LysC_Try_1to10_Mixt_1_1        1   4023100</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; 2 121219_S_CCES_01_02_LysC_Try_1to10_Mixt_1_2        1   5132500</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; 3 121219_S_CCES_01_03_LysC_Try_1to10_Mixt_1_3        1   2761600</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt; 4 121219_S_CCES_01_04_LysC_Try_1to10_Mixt_2_1        1   2932900</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt; 5 121219_S_CCES_01_05_LysC_Try_1to10_Mixt_2_2        1   4091800</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; 6 121219_S_CCES_01_06_LysC_Try_1to10_Mixt_2_3        1   4727000</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(maxquant_balanced)</a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt; [1] 690  11</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(maxquant_processed)</a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt; [1] 625  14</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"></a>
<a class="sourceLine" id="cb8-29" data-line-number="29">openms_balanced =<span class="st"> </span><span class="kw"><a href="../reference/MSstatsBalancedDesign.html">MSstatsBalancedDesign</a></span>(openms_processed, feature_columns_tmt)</a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(openms_balanced)</a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="co">#&gt;            ProteinName                               PeptideSequence</span></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="co">#&gt; 1 sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt; 2 sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="co">#&gt; 3 sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="co">#&gt; 4 sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36"><span class="co">#&gt; 5 sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb8-37" data-line-number="37"><span class="co">#&gt; 6 sp|Q60854|SPB6_MOUSE .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR</span></a>
<a class="sourceLine" id="cb8-38" data-line-number="38"><span class="co">#&gt;   PrecursorCharge                                             PSM Mixture</span></a>
<a class="sourceLine" id="cb8-39" data-line-number="39"><span class="co">#&gt; 1               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3       3</span></a>
<a class="sourceLine" id="cb8-40" data-line-number="40"><span class="co">#&gt; 2               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3       3</span></a>
<a class="sourceLine" id="cb8-41" data-line-number="41"><span class="co">#&gt; 3               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3       3</span></a>
<a class="sourceLine" id="cb8-42" data-line-number="42"><span class="co">#&gt; 4               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3       3</span></a>
<a class="sourceLine" id="cb8-43" data-line-number="43"><span class="co">#&gt; 5               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3       3</span></a>
<a class="sourceLine" id="cb8-44" data-line-number="44"><span class="co">#&gt; 6               3 .(TMT6plex)AFVEVNEEGTEAAAATAGMM(Oxidation)TVR_3       3</span></a>
<a class="sourceLine" id="cb8-45" data-line-number="45"><span class="co">#&gt;   TechRepMixture   Run Channel BioReplicate Condition Intensity</span></a>
<a class="sourceLine" id="cb8-46" data-line-number="46"><span class="co">#&gt; 1            3_3 3_3_3       1           21   Long_HF        NA</span></a>
<a class="sourceLine" id="cb8-47" data-line-number="47"><span class="co">#&gt; 2            3_3 3_3_3       2           22      Norm  1068.580</span></a>
<a class="sourceLine" id="cb8-48" data-line-number="48"><span class="co">#&gt; 3            3_3 3_3_3       3           23    Long_M  1508.330</span></a>
<a class="sourceLine" id="cb8-49" data-line-number="49"><span class="co">#&gt; 4            3_3 3_3_3       4           24   Long_HF        NA</span></a>
<a class="sourceLine" id="cb8-50" data-line-number="50"><span class="co">#&gt; 5            3_3 3_3_3       5           25   Long_LF  1580.951</span></a>
<a class="sourceLine" id="cb8-51" data-line-number="51"><span class="co">#&gt; 6            3_3 3_3_3       6           26   Long_HF  1820.072</span></a>
<a class="sourceLine" id="cb8-52" data-line-number="52"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(openms_balanced)</a>
<a class="sourceLine" id="cb8-53" data-line-number="53"><span class="co">#&gt; [1] 330  11</span></a>
<a class="sourceLine" id="cb8-54" data-line-number="54"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(openms_processed)</a>
<a class="sourceLine" id="cb8-55" data-line-number="55"><span class="co">#&gt; [1] 370  15</span></a></code></pre></div>
<p><code>MSstatsBalancedDesign</code> output is a <code>data.frame</code> of class <code>MSstatsValidated</code>. Such a <code>data.frame</code> will be recognized by statistical processing functions from <code>MSstats</code> and <code>MSstatsTMT</code> packages as a valid input, which will allow them to skip checks and transformation necessary to fit data into this format.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#purpose-of-msstatsconvert">Purpose of MSstatsConvert</a></li>
      <li><a href="#msstats-data-format">MSstats data format</a></li>
      <li><a href="#logging">Logging</a></li>
      <li><a href="#importing-and-cleaning-data">Importing and cleaning data</a></li>
      <li><a href="#preprocessing">Preprocessing</a></li>
      <li><a href="#fractions-and-balanced-design">Fractions and balanced design</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mateusz Staniak, Meena Choi, Ting Huang, Olga Vitek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
